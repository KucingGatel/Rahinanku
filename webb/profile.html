<script>
  const userData = JSON.parse(localStorage.getItem('userData'));
if (!userData || !userData.account_id) {
    alert('User tidak ditemukan, silakan login terlebih dahulu.');
    window.location.href = 'login.html';
}
</script>
<!doctype html>
<html class="no-js" lang="zxx">
    <head>
        <!-- Meta Tags -->
		<meta charset="utf-8">
		<meta http-equiv="X-UA-Compatible" content="IE=edge">
		<meta name="keywords" content="Site keywords here">
		<meta name="description" content="">
		<meta name='copyright' content=''>
		<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
		
		<!-- Title -->
        <title>Rahinanku</title>
		
		<!-- Favicon -->
        <link rel="icon" href="img/favicon.png">
		
		<!-- Google Fonts -->
		<link href="https://fonts.googleapis.com/css?family=Poppins:200i,300,300i,400,400i,500,500i,600,600i,700,700i,800,800i,900,900i&display=swap" rel="stylesheet">

		<!-- Bootstrap CSS -->
		<link rel="stylesheet" href="css/bootstrap.min.css">
		<!-- Nice Select CSS -->
		<link rel="stylesheet" href="css/nice-select.css">
		<!-- Font Awesome CSS -->
        <link rel="stylesheet" href="css/font-awesome.min.css">
		<!-- icofont CSS -->
        <link rel="stylesheet" href="css/icofont.css">
		<!-- Slicknav -->
		<link rel="stylesheet" href="css/slicknav.min.css">
		<!-- Owl Carousel CSS -->
        <link rel="stylesheet" href="css/owl-carousel.css">
		<!-- Datepicker CSS -->
		<link rel="stylesheet" href="css/datepicker.css">
		<!-- Animate CSS -->
        <link rel="stylesheet" href="css/animate.min.css">
		<!-- Magnific Popup CSS -->
        <link rel="stylesheet" href="css/magnific-popup.css">
		
		<!-- Medipro CSS -->
        <link rel="stylesheet" href="css/normalize.css">
        <link rel="stylesheet" href="style.css">
        <link rel="stylesheet" href="css/responsive.css">
		
    </head>
    <body>
		<!-- Preloader -->
    <div class="preloader">
      <div class="loader">
          <div class="loader-outter"></div>
          <div class="loader-inner"></div>

          <div class="indicator"> 
            <img src="img/favicon.png">
          </div>
      </div>
  </div>
        <!-- End Preloader -->
		
		<my-header></my-header>
		
		<!-- Error Page -->
        <style>
            .profile-container2 {
            text-align: center;
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .profile-photo {
            width: 150px;
            height: 150px;
            border-radius: 50%;
            border: 2px solid #ddd;
            object-fit: cover;
            margin-bottom: 20px;
        }

        .upload-btn {
            display: inline-block;
            padding: 10px 20px;
            font-size: 14px;
            color: white;
            background-color: #007bff;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            margin-top: 10px;
        }

        .upload-btn:hover {
            background-color: #0056b3;
        }

        input[type="file"] {
            display: none;
        }

        .save-btn {
            display: inline-block;
            padding: 10px 20px;
            font-size: 14px;
            color: white;
            background-color: #28a745;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            margin-top: 10px;
        }

        .save-btn:hover {
            background-color: #218838;
        }
        </style>
            <div class="profile-container">
              <div class="profile-wrapper">
                <div class="profile-content">
                  <div class="profile-layout">                    
                    <div class="kelas">
                      <div class="profile-container2">
                        <img id="profilePhoto" class="profile-photo" src="https://via.placeholder.com/150" alt="Profile Photo">
                        <br>
                        <label class="btn" for="fileInput">Change Photo</label>
                        <input type="file" id="fileInput" accept="image/*">
                        <br>
                        <button class="save-btn" id="savePhoto">Save Photo</button>
                      </div>
                    </div>
                    <div class="profile-form-column">
                      <form class="form-container" id="profile-form">
                        <h1 class="form-title">Manage My Account</h1>
                        <div class="form-wrapper">
                          <div class="form-fields">
                            <div class="input-group">
                              <label for="username" class="input-label">Username</label>
                              <input type="text" id="username" class="form-input" aria-label="Username">
                            </div>
                            <div class="input-group">
                              <label for="firstname" class="input-label">First Name</label>
                              <input type="text" id="firstname" class="form-input" aria-label="First Name" readonly>
                            </div>
                            <div class="input-group">
                              <label for="email" class="input-label">Address<span class="required">*</span></label>
                              <input type="email" id="email" class="form-input" required aria-label="Email Address" readonly>
                            </div>
                            <div class="input-group">
                              <label for="phone" class="input-label">Phone Number</label>
                              <input type="tel" id="phone" class="form-input" aria-label="Phone Number">
                            </div>
                            <div class="input-group">
                              <label for="gender" class="input-label">Gender</label>
                              <select id="gender" class="form-input" aria-label="Gender">
                                <option value="man">Male</option>
                                <option value="woman">Female</option>
                              </select>
                            </div>
                            <div class="input-group">
                              <label for="birthdate" class="input-label">Birth Date</label>
                              <input type="date" id="birthdate" class="form-input" aria-label="Birth Date">
                            </div>
                          </div>
                          <div id="store-link-container" style="margin-top: 5%;">
                            <!-- <a href="buat-toko-2.html">
                              <h5 style="color: grey;">Make a Store!</h5>
                            </a> -->
                          </div>
                        </div>
                        <div style="margin-left: 20%;; margin-top: 5%;">
                          <button type="button" class="btn btn-cancel">Cancel</button>
                          <!-- <button style="margin-left: 30%;"   type="submit" class="btn btn-save">Save Changes</button> -->
                          <button style="margin-left: 30%;" type="submit" class="btn btn-save" id="save-button">Save Changes</button>
                        </div>
                      </form>
                    </div>
                  </div>
                </div>
              </div>
            </div>
		
		<my-footer></my-footer>
		
    <!-- <script>
      // URL API
      const API_URL = "http://localhost:3000/api/user/Profile";
    
      // Function untuk memuat profil user
      async function loadProfile() {
        try {
          // Ambil ID user dari Local Storage (pastikan sebelumnya disimpan)
          const id_user = userData.account_id;
          if (!id_user) {
            alert("User ID tidak ditemukan.");
            return;
          }
    
          // Panggil API
          const response = await fetch(API_URL, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ id_user }),
          });
    
          const result = await response.json();
          if (!result.success) {
            alert("Gagal memuat data profil.");
            return;
          }
    
          // Ambil data dari API
          const { data, toko } = result;
    
          // Masukkan data ke form
          const username = document.getElementById("username");
          const firstname = document.getElementById("firstname");
          const email = document.getElementById("email");
          const phone = document.getElementById("phone");
          const gender = document.getElementById("gender");
          const birthdate = document.getElementById("birthdate");
    
          // Masukkan data ke masing-masing elemen
          username.value = data.name; // Nama lengkap
          firstname.value = data.name.split(" ")[0]; // Nama depan saja
          email.value = data.Addresses[0]?.alamat || ""; // Alamat (jika ada)
          phone.value = data.phone_number || ""; // Nomor telepon
          gender.value = data.gender || ""; // Gender
          birthdate.value = data.birth_date || ""; // Tanggal lahir
    
          // Simpan ID toko ke Local Storage
          if (toko) {
            localStorage.setItem("id_toko", toko.id_toko);
          }
        } catch (error) {
          console.error("Error memuat profil:", error);
        }
      }
    
      // Panggil fungsi saat halaman dimuat
      document.addEventListener("DOMContentLoaded", loadProfile);
    </script> -->

    <script>
      document.addEventListener("DOMContentLoaded", async () => {
  const API_URL = "http://localhost:3000/api/user/Profile";
  const id_user = userData.account_id; // Ganti dengan ID user yang sesuai.

  try {
    const response = await fetch(API_URL, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ id_user }),
    });

    if (!response.ok) {
      throw new Error(`HTTP error! Status: ${response.status}`);
    }

    const { success, data, toko } = await response.json();
    // const genderElement = document.getElementById("gender");
    // const genderElement = document.getElementById("gender");
    // const options = Array.from(genderElement.options);
    if (success) {
      // Isi data ke dalam form
      
      document.getElementById("username").value = data.name; // Nama depan
      document.getElementById("firstname").value = data.name.split(" ")[0];
      document.getElementById("phone").value = data.phone_number;
      document.getElementById("gender").value = data.gender;
      // document.getElementById("gender").value = "woman";
      document.getElementById("birthdate").value = data.birth_date.split("T")[0]; // Format tanggal
      document.getElementById("email").value = data.Addresses[0]?.alamat || "";
      

      
    //   console.log(options[0]);
    // if (data.gender === "woman") {
    //     genderElement.selectedIndex = 1;
    //     genderElement.options[1].selected = true;
    //     console.log("TEST");
    //     // console.log(options[1].value);
    //   }



    //   console.log("Gender from API:", data.gender);
    //   console.log("Select element:", document.getElementById("gender"));

      // Simpan ID Toko ke localStorage
      if (toko && toko.id_toko) {
        localStorage.setItem("id_toko", toko.id_toko);
      }
    } else {
      console.error("Failed to load profile data");
    }
  } catch (error) {
    console.error("Error memuat profil:", error);
  }
});
    </script>

<script>
  // Periksa apakah id_toko ada di localStorage
  const id_toko = localStorage.getItem("id_toko");

  // Referensi elemen kontainer
  const container = document.getElementById("store-link-container");

  if (id_toko) {
    // Jika id_toko ada, arahkan ke halaman toko
    container.innerHTML = `
      <a href="toko.html?id_toko=${id_toko}">
        <h5 style="color: grey;">View a Store!</h5>
      </a>
    `;
  } else {
    // Jika id_toko tidak ada, arahkan ke halaman buat toko
    container.innerHTML = `
      <a href="buat-toko-2.html">
        <h5 style="color: grey;">Make a Store!</h5>
      </a>
    `;
  }
</script>

<script>
  document.getElementById("profile-form").addEventListener("submit", async (event) => {
    event.preventDefault(); // Mencegah form refresh halaman

    // Ambil data dari form
    const name = document.getElementById("username").value;
    const phone_number = document.getElementById("phone").value;
    const gender = document.getElementById("gender").value;
    const birth_date = document.getElementById("birthdate").value;
    const account_id = userData.account_id;
    

    // Buat payload data untuk API
    const payload = {
        name,
        phone_number,
        gender,
        birth_date,
        account_id,
    };

    try {
        // Kirim permintaan ke API
        const response = await fetch("http://localhost:3000/api/user/UpdateProfile", {
            method: "PUT",
            headers: {
                "Content-Type": "application/json",
            },
            body: JSON.stringify(payload),
        });

        // Parsing respons dari API
        const result = await response.json();

        if (response.ok) {
            alert(result.msg); // Menampilkan pesan sukses
        } else {
            alert(`Error: ${result.msg}`); // Menampilkan pesan error
        }
    } catch (error) {
        console.error("Error updating profile:", error);
        alert("Terjadi kesalahan saat memperbarui profil. Silakan coba lagi.");
    }
});

</script>

		<!-- header footer JS -->
		 <script src="js/headerfooterLogin.js"></script>
    <!-- foto profile -->
     <script src="js/profile.js" ></script>
		<!-- jquery Min JS -->
        <script src="js/jquery.min.js"></script>
		<!-- jquery Migrate JS -->
		<script src="js/jquery-migrate-3.0.0.js"></script>
		<!-- jquery Ui JS -->
		<script src="js/jquery-ui.min.js"></script>
		<!-- Easing JS -->
        <script src="js/easing.js"></script>
		<!-- Color JS -->
		<script src="js/colors.js"></script>
		<!-- Popper JS -->
		<script src="js/popper.min.js"></script>
		<!-- Bootstrap Datepicker JS -->
		<script src="js/bootstrap-datepicker.js"></script>
		<!-- Jquery Nav JS -->
        <script src="js/jquery.nav.js"></script>
		<!-- Slicknav JS -->
		<script src="js/slicknav.min.js"></script>
		<!-- ScrollUp JS -->
        <script src="js/jquery.scrollUp.min.js"></script>
		<!-- Niceselect JS -->
		<script src="js/niceselect.js"></script>
		<!-- Tilt Jquery JS -->
		<script src="js/tilt.jquery.min.js"></script>
		<!-- Owl Carousel JS -->
        <script src="js/owl-carousel.js"></script>
		<!-- counterup JS -->
		<script src="js/jquery.counterup.min.js"></script>
		<!-- Steller JS -->
		<script src="js/steller.js"></script>
		<!-- Wow JS -->
		<script src="js/wow.min.js"></script>
		<!-- Magnific Popup JS -->
		<script src="js/jquery.magnific-popup.min.js"></script>
		<!-- Counter Up CDN JS -->
		<script src="http://cdnjs.cloudflare.com/ajax/libs/waypoints/2.0.3/waypoints.min.js"></script>
		<!-- Bootstrap JS -->
		<script src="js/bootstrap.min.js"></script>
		<!-- Main JS -->
		<script src="js/main.js"></script>
    </body>
</html>